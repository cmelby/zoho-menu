<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Genosis â€¢ Product Menu</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Palette: Deep, rich darks and refined golds */
      --bg: #050505;
      --panel: #111111;
      --panel-hover: #161616;
      --stroke: #222;
      --stroke-hover: #333;
      --text: #e5e5e5;
      --muted: #888;

      /* Accents */
      --accent1: #d4af37;
      --accent2: #f3e5ab;
      /* lighter gold for gradients */
      --accent-glow: rgba(212, 175, 55, 0.15);

      /* Spacing & Layout */
      --radius: 12px;
      --radius-sm: 8px;
      --header-h: 80px;
      --header-h-compact: 64px;
      --logo-h: 48px;
      --logo-h-compact: 40px;
      --section-nav-h: 56px;
      --container: 1200px;
    }

    @media (max-width:640px) {
      :root {
        --header-h: 70px;
        --header-h-compact: 60px;
      }
    }

    html,
    body {
      height: 100%
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      line-height: 1.6;
    }

    /* ===== HEADER ===== */
    .header-wrap {
      position: fixed;
      inset: 0 0 auto 0;
      z-index: 100;
      background: rgba(5, 5, 5, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
      transition: all 0.3s ease;
    }

    .header {
      height: var(--header-h);
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: var(--container);
      margin: 0 auto;
      padding: 0 24px;
      transition: height 0.3s ease;
      position: relative;
    }

    /* Layout Columns */
    .header__left,
    .header__right {
      flex: 1;
      display: flex;
      align-items: center;
    }

    .header__right {
      justify-content: flex-end;
      gap: 12px;
    }

    .header__center {
      flex: 0 0 auto;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }

    .logo {
      height: var(--logo-h);
      width: auto;
      display: block;
      transition: height 0.3s ease;
      filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.1));
    }

    .brandline {
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      font-size: 14px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .brandline .highlight {
      color: var(--accent1);
      font-weight: 700;
    }

    /* Compact State */
    .header--centered .header {
      height: var(--header-h-compact);
    }

    .header--centered .logo {
      height: var(--logo-h-compact);
    }

    /* ===== TOOLBAR ===== */
    .toolbar {
      max-width: var(--container);
      margin: 0 auto;
      padding: 12px 24px;
      display: flex;
      gap: 12px;
      align-items: center;
    }

    /* Inputs & Controls */
    input,
    select,
    button,
    textarea {
      font-family: inherit;
      font-size: 14px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--stroke);
      background: var(--panel);
      color: var(--text);
      padding: 10px 16px;
      transition: all 0.2s ease;
      outline: none;
    }

    input::placeholder,
    textarea::placeholder {
      color: #555;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--accent1);
      box-shadow: 0 0 0 2px var(--accent-glow);
      background: var(--panel-hover);
    }

    button {
      cursor: pointer;
      font-weight: 500;
      background: var(--panel);
    }

    button:hover:not([disabled]) {
      border-color: var(--muted);
      background: var(--panel-hover);
      transform: translateY(-1px);
    }

    button:active:not([disabled]) {
      transform: translateY(0);
    }

    button.primary {
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
      color: #000;
      border: none;
      font-weight: 600;
    }

    button.primary:hover:not([disabled]) {
      filter: brightness(1.1);
      box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
    }

    button[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }

    #search {
      flex: 1;
      max-width: 320px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: 12px center;
      padding-left: 40px;
    }

    /* ===== SECTION NAV ===== */
    #section-nav {
      max-width: var(--container);
      margin: 0 auto;
      padding: 0 24px 16px;
      display: flex;
      gap: 8px;
      overflow-x: auto;
      scrollbar-width: none;
      /* Firefox */
    }

    #section-nav::-webkit-scrollbar {
      display: none;
    }

    #section-nav a {
      font-size: 13px;
      font-weight: 500;
      color: var(--muted);
      text-decoration: none;
      padding: 6px 16px;
      border-radius: 100px;
      border: 1px solid transparent;
      background: rgba(255, 255, 255, 0.03);
      transition: all 0.2s;
      white-space: nowrap;
    }

    #section-nav a:hover {
      color: var(--text);
      background: rgba(255, 255, 255, 0.08);
    }

    #section-nav a.active {
      color: var(--accent1);
      background: rgba(212, 175, 55, 0.1);
      border-color: rgba(212, 175, 55, 0.2);
    }

    /* ===== MAIN CONTENT ===== */
    .content {
      max-width: var(--container);
      margin: 0 auto;
      padding: 24px;
      /* Padding top is handled by JS to match header height */
    }

    .section {
      margin-bottom: 48px;
      animation: fadeIn 0.6s ease forwards;
    }

    .section__title {
      font-family: 'Montserrat', sans-serif;
      font-size: 20px;
      font-weight: 600;
      color: var(--text);
      margin: 0 0 24px 0;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .section__title::after {
      content: '';
      height: 1px;
      flex: 1;
      background: linear-gradient(90deg, var(--stroke) 0%, transparent 100%);
    }

    .section__grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
    }

    /* ===== CARDS ===== */
    .card {
      background: var(--panel);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      padding: 24px;
      display: flex;
      flex-direction: column;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      position: relative;
      overflow: hidden;
    }

    .card:hover {
      transform: translateY(-4px);
      border-color: var(--stroke-hover);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
      background: var(--panel-hover);
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, var(--accent1), transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .card:hover::before {
      opacity: 1;
    }

    .title {
      font-size: 18px;
      font-weight: 600;
      line-height: 1.3;
      margin: 0 0 8px;
      color: var(--text);
    }

    .price-line {
      display: flex;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 16px;
    }

    .price-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted);
    }

    .price {
      font-size: 16px;
      font-weight: 700;
      color: var(--accent1);
    }

    .desc-wrap {
      flex: 1;
      margin-bottom: 20px;
    }

    .desc-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #555;
      margin-bottom: 6px;
    }

    .desc {
      font-size: 14px;
      color: var(--muted);
      margin: 0;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .card .row {
      margin-top: auto;
    }

    .card .select {
      width: 100%;
      margin-bottom: 12px;
    }

    .card .row-end {
      display: flex;
      justify-content: center;
      align-items: center;
      padding-top: 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
    }

    .place-btn {
      width: 100%;
      padding: 10px 16px;
      font-size: 14px;
      background: transparent;
      border: 1px solid var(--stroke);
      text-align: center;
    }

    .place-btn:hover:not([disabled]) {
      border-color: var(--accent1);
      color: var(--accent1);
    }

    /* ===== MODAL ===== */
    .modal {
      position: fixed;
      inset: 0;
      z-index: 200;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.2s ease;
    }

    .modal-card {
      width: 100%;
      max-width: 440px;
      background: #111;
      border: 1px solid var(--stroke);
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 24px 48px rgba(0, 0, 0, 0.5);
    }

    .modal h2 {
      margin: 0 0 24px;
      font-family: 'Montserrat', sans-serif;
      font-size: 24px;
    }

    .modal .row {
      margin-bottom: 12px;
    }

    .modal input,
    .modal textarea {
      width: 100%;
      background: #0a0a0a;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 24px;
    }

    /* ===== UTILS ===== */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .banner {
      margin: 20px auto;
      max-width: var(--container);
      padding: 12px;
      border-radius: var(--radius-sm);
      background: rgba(212, 175, 55, 0.1);
      border: 1px solid rgba(212, 175, 55, 0.2);
      color: var(--accent1);
      font-size: 13px;
      text-align: center;
    }

    /* Mobile */
    @media (max-width: 768px) {
      .header {
        padding: 0 16px;
      }

      .toolbar {
        padding: 12px 16px;
        flex-wrap: wrap;
      }

      #search {
        max-width: 100%;
        order: 1;
        width: 100%;
      }

      #perPage,
      #refresh {
        order: 2;
      }

      .header__left {
        display: none;
      }

      /* Hide brand text on mobile to save space if logo is centered */
      .header__center {
        position: static;
        transform: none;
        flex: 1;
        justify-content: flex-start;
      }

      .logo {
        height: 32px;
      }
    }
  </style>
</head>

<body>
  <!-- ===== HEADER ===== -->
  <div class="header-wrap" id="headerWrap">
    <div class="header" id="header">
      <div class="header__left">
        <div class="brandline"><span class="muted">Product Menu</span></div>
      </div>
      <div class="header__center">
        <img src="/logo-genosis.png" alt="Genosis" class="logo" id="logo" />
      </div>
      <div class="header__right"></div>
    </div>

    <div class="toolbar">
      <input id="search" placeholder="Search products..." />
      <select id="perPage">
        <option value="50">50</option>
        <option value="100">100</option>
        <option value="200" selected>200</option>
      </select>
      <button id="refresh">Refresh</button>
    </div>

    <div id="section-nav"></div>
  </div>

  <div class="banner" id="banner" style="display:none;"></div>

  <div class="content">
    <div id="sections"></div>
  </div>

  <!-- MODAL -->
  <div class="modal" id="leadModal">
    <div class="modal-card">
      <h2 id="modalTitle">Place order</h2>
      <div class="row"><input id="firstName" placeholder="First name" required /></div>
      <div class="row"><input id="lastName" placeholder="Last name" required /></div>
      <div class="row"><input id="email" type="email" placeholder="Email" required /></div>
      <div class="row"><input id="phone" placeholder="Phone" required /></div>
      <div class="row"><textarea id="notes" placeholder="Notes (optional)"></textarea></div>
      <div class="modal-actions">
        <button class="btn" id="cancelBtn">Cancel</button>
        <button class="btn primary" id="createLeadBtn">Submit</button>
      </div>
    </div>
  </div>

  <!-- HEADER SCROLL -->
  <script>
    (function () {
      const headerWrap = document.getElementById('headerWrap');
      let centered = false;
      function onScroll() {
        const shouldCenter = window.scrollY > 40;
        if (shouldCenter !== centered) { centered = shouldCenter; headerWrap.classList.toggle('header--centered', centered); }
      }
      onScroll(); window.addEventListener('scroll', onScroll, { passive: true });
    })();
  </script>

  <script>
    // Keep content padded below the fixed headerWrap (which now contains
    // header, toolbar, and section nav). This responds to header compacting
    // and nav size changes.
    (function () {
      const headerWrap = document.getElementById('headerWrap');
      const content = document.querySelector('.content');
      const nav = document.getElementById('section-nav');

      function refresh() {
        if (!headerWrap || !content) return;
        const h = headerWrap.offsetHeight || 0;
        content.style.paddingTop = (h + 8) + 'px';
      }

      window.addEventListener('load', refresh);
      window.addEventListener('resize', refresh);
      window.addEventListener('scroll', refresh);

      const obs = new MutationObserver(refresh);
      if (nav) obs.observe(nav, { childList: true, subtree: true });

      setTimeout(refresh, 50);
    })();
  </script>

  <!-- MENU APP -->
  <script>
    /* === Weight options driven by Zoho "unit" (Usage Unit) === */
    const WEIGHT_OPTIONS_BY_UNIT = {
      kg: ['250 g', '500 g', '1 kg', '5 kg', '10 kg', '25 kg'],
      g: ['100 g', '250 g', '500 g', '1 kg'],
      lb: ['1 lb', '5 lb', '10 lb', '25 lb'],
      oz: ['1 oz', '2 oz', '4 oz', '8 oz', '16 oz'],
      l: ['1 L', '5 L'],
      unit: ['10 ct', '25 ct', '50 ct', '100 ct'],
      pcs: ['10 ct', '25 ct', '50 ct', '100 ct'],
      tablet: ['100 ct', '250 ct', '500 ct', '1000 ct']
    };
    const DEFAULT_WEIGHTS = ['250 g', '500 g', '1 kg', '5 kg', '10 kg'];

    function optionsForUnit(uRaw) {
      const u = (uRaw || '').toString().trim().toLowerCase();
      if (WEIGHT_OPTIONS_BY_UNIT[u]) return WEIGHT_OPTIONS_BY_UNIT[u];
      if (u === 'kilogram' || u === 'kgs') return WEIGHT_OPTIONS_BY_UNIT['kg'];
      if (u === 'pound' || u === 'lbs') return WEIGHT_OPTIONS_BY_UNIT['lb'];
      if (u === 'liter') return WEIGHT_OPTIONS_BY_UNIT['l'];
      if (u === 'milliliter' || u === 'ml') return WEIGHT_OPTIONS_BY_UNIT['l'];
      if (u === 'piece' || u === 'each') return WEIGHT_OPTIONS_BY_UNIT['unit'];
      return DEFAULT_WEIGHTS;
    }

    /* === Group strictly by Zoho built-in category_name === */
    function normalizeStr(v) { return v == null ? '' : String(v).trim(); }
    function isJunk(v) { const s = normalizeStr(v).toLowerCase(); return !s || ['uncategorized', 'n/a', 'na', '-'].includes(s); }
    function getSection(item) { const c = normalizeStr(item.category_name); return !isJunk(c) ? c : 'Other'; }
    function buildSections(items) {
      const m = new Map();
      for (const it of items) { const sec = getSection(it); if (!m.has(sec)) m.set(sec, []); m.get(sec).push(it); }
      const keys = [...m.keys()];
      const real = keys.filter(k => k !== 'Other');
      const ordered = (real.length ? real : ['Other']).sort((a, b) => a.localeCompare(b));
      return { ordered, buckets: m };
    }

    /* === UI refs === */
    const banner = document.getElementById('banner');
    const search = document.getElementById('search');
    const perPage = document.getElementById('perPage');
    const refreshBtn = document.getElementById('refresh');
    const sectionsEl = document.getElementById('sections');
    const navEl = document.getElementById('section-nav');

    const leadModal = document.getElementById('leadModal');
    const modalTitle = document.getElementById('modalTitle');
    const firstNameEl = document.getElementById('firstName');
    const lastNameEl = document.getElementById('lastName');
    const emailEl = document.getElementById('email');
    const phoneEl = document.getElementById('phone');
    const notesEl = document.getElementById('notes');
    const cancelBtn = document.getElementById('cancelBtn');
    const createLeadBtn = document.getElementById('createLeadBtn');

    /* === State === */
    let allItems = []; let preview = false; let selectedProduct = null; let selectedWeight = '';

    const DEMO_ITEMS = [{ id: '1', name: 'Demo Product', rate: 100, description: 'Demo', sku: 'DEMO', category_name: 'Sample', unit: 'kg' }];

    /* === Data === */
    async function fetchItems(page = 1) {
      const res = await fetch(`/api/items?page=${page}&per_page=${perPage.value}`);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    }
    async function loadAll() {
      sectionsEl.innerHTML = '';
      let page = 1, items = [], more = true;
      try {
        while (more) {
          const data = await fetchItems(page);
          const chunk = (data.items || []).map(x => ({
            id: x.item_id, name: x.name, rate: x.rate,
            description: (x.description || '').trim(),
            sku: x.sku || x.item_name || '',
            category_name: x.category_name || '',
            unit: x.unit || '',
            weight_options: (x.weight_options || '').trim()
          }));
          items = items.concat(chunk);
          const ctx = data.page_context || {}; const cur = ctx.page || page; const total = ctx.total_pages || 1;
          more = cur < total; page++;
        }
        allItems = items;
      } catch (e) {
        preview = true; allItems = DEMO_ITEMS;
        banner.style.display = 'block';
        banner.innerHTML = '<span class="warn">Preview mode:</span> Using sample products (API did not return live data).';
      }
      render();
    }

    /* === Cards & render === */
    function escapeHtml(s) { return String(s).replace(/[&<>\"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m])) }

    function createCard(item) {
      const node = document.createElement('div');
      node.className = 'card';

      const derived = optionsForUnit(item.unit);
      const explicit = (item.weight_options || '').split(',').map(s => s.trim()).filter(Boolean);
      const weights = explicit.length ? explicit : derived;
      const unitLabel = (item.unit || '').toString().trim();

      node.innerHTML = `
        <h3 class="title">${escapeHtml(item.name)}</h3>

        <div class="price-line">
          <span class="price-label">Starting&nbsp;at</span>
          <span class="price">$${Number(item.rate || 0).toLocaleString()}</span>
        </div>

        <div class="desc-wrap">
          <div class="desc-label">Product Description</div>
          <p class="desc">${escapeHtml(item.description || '')}</p>
        </div>

        <div class="spacer"></div>

        <div class="row">
          <select class="select weight-select" aria-label="Select size">
            <option value="">Select size${unitLabel ? ` (${escapeHtml(unitLabel)})` : ''}</option>
            ${weights.map(w => `<option value="${escapeHtml(w)}">${escapeHtml(w)}</option>`).join('')}
          </select>
        </div>

        <div class="row-end">
          <button class="place-btn primary" disabled>Place order</button>
        </div>
      `;

      const weightSel = node.querySelector('.weight-select');
      const btn = node.querySelector('.place-btn');
      weightSel.addEventListener('change', () => { btn.disabled = !weightSel.value; });
      btn.addEventListener('click', () => {
        if (!weightSel.value) {
          // clear, focus and notify user to select a size before placing order
          weightSel.focus();
          weightSel.classList.add('highlight');
          setTimeout(() => weightSel.classList.remove('highlight'), 1200);
          return alert('Please select a size before placing your order.');
        }
        openLeadModal(item, weightSel.value);
      });

      return node;
    }

    function render() {
      const q = (search.value || '').toLowerCase();
      const filtered = allItems.filter(i => i.name.toLowerCase().includes(q) || (i.sku || '').toLowerCase().includes(q));

      const { ordered, buckets } = buildSections(filtered);

      // Section nav
      navEl.innerHTML = '';
      ordered.forEach(sec => {
        const a = document.createElement('a'); a.textContent = sec; a.href = `#sec-${encodeURIComponent(sec)}`;
        navEl.appendChild(a);
      });

      // Sections
      sectionsEl.innerHTML = '';
      if (!ordered.length) {
        const empty = document.createElement('div'); empty.className = 'card'; empty.textContent = 'No products found.'; sectionsEl.appendChild(empty); return;
      }

      ordered.forEach(sec => {
        const items = buckets.get(sec) || []; if (!items.length) return;
        const section = document.createElement('section'); section.className = 'section'; section.id = `sec-${encodeURIComponent(sec)}`;

        const h = document.createElement('h2'); h.className = 'section__title'; h.textContent = sec; section.appendChild(h);

        const g = document.createElement('div'); g.className = 'section__grid';
        items.forEach(it => g.appendChild(createCard(it)));
        section.appendChild(g);

        sectionsEl.appendChild(section);
      });
    }

    /* ------------ Modal ------------ */
    function openLeadModal(item, weight) {
      selectedProduct = item; selectedWeight = weight;
      modalTitle.textContent = `Place order: ${item.name}`;
      firstNameEl.value = ''; lastNameEl.value = ''; emailEl.value = ''; phoneEl.value = ''; notesEl.value = '';
      leadModal.style.display = 'flex';
    }
    document.getElementById('cancelBtn').addEventListener('click', () => { leadModal.style.display = 'none'; selectedProduct = null; selectedWeight = ''; });
    document.getElementById('createLeadBtn').addEventListener('click', async () => {
      if (!selectedProduct) return;
      if (!firstNameEl.value.trim()) { firstNameEl.focus(); return alert('Please enter your first name.'); }
      if (!lastNameEl.value.trim()) { lastNameEl.focus(); return alert('Please enter your last name.'); }
      if (!emailEl.value.trim()) { emailEl.focus(); return alert('Please enter your email.'); }
      if (!phoneEl.value.trim()) { phoneEl.focus(); return alert('Please enter your phone.'); }

      const payload = {
        firstName: firstNameEl.value.trim(),
        lastName: lastNameEl.value.trim(),
        email: emailEl.value.trim(),
        phone: phoneEl.value.trim(),
        productName: selectedProduct.name,
        notes: (notesEl.value || '').trim() ? `Selected size: ${selectedWeight}\n${notesEl.value.trim()}` : `Selected size: ${selectedWeight}`
      };

      const res = await fetch('/api/lead', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
      const json = await res.json().catch(() => ({}));
      if (!res.ok) { alert('Request failed: ' + (json.message || json.error || res.status)); return; }

      alert('Thanks! Your order request has been sent.');
      leadModal.style.display = 'none'; selectedProduct = null; selectedWeight = '';
    });

    /* ------------ Search/Refresh ------------ */
    search.addEventListener('input', render);
    refreshBtn.addEventListener('click', loadAll);

    /* ------------ Boot ------------ */
    loadAll();
  </script>
</body>

</html>